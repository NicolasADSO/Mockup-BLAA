<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Editar Proceso - BlaaFlow</title>
  <link rel="stylesheet" href="../assets/css/layout.css">
  <link rel="stylesheet" href="../assets/css/control-procesos/editar-proceso.css">
</head>
<body>
  <!-- NAVBAR -->
  <div class="navbar">
    <img src="../assets/img/logo-sin-fondo.png" alt="Logo Gadier">
    <div class="search-profile">
      <input type="text" placeholder="Buscar...">
      <div class="profile">A</div>
    </div>
  </div>

  <!-- SIDEBAR -->
  <div class="sidebar">
    <ul>
      <li class="active">
        <a href="dashboard.html" style="color: inherit; text-decoration: none;">Dashboard Admin</a>
      </li>

      <div class="section-title"><b>Fases Especializadas ▿</b></div>
      <li><a href="../empaste/empaste.html">Encuadernación / Empaste</a></li>
      <li><a href="../catalogacion/catalogacion.html">Catalogaciones</a></li>
      <li><a href="../entrega/entrega.html">Entrega Final</a></li>
      <li><a href="../digitalizacion/digitalizacion.html">Digitalización</a></li>
      <li><a href="../calidad/calidad.html">Control de Calidad</a></li>
      <li><a href="../terminado/terminado.html">Terminado Final</a></li>
      <li><a href="../alistamiento/alistamiento.html">Alistamiento</a></li>

      <div class="section-title"><b>Seguimiento ▿</b></div>
      <li><a href="../control-procesos/procesos.html">Control de Procesos</a></li>
      <li><a href="../historial-procesos/historial-proceso.html">Historial de Procesos</a></li>
      <li><a href="../historial-tiempo.html">Historial de Tiempos</a></li>
      
      <div class="section-title"><b>Configuración ▿</b></div>
      <li><a href="../configuracion/permisos.html">Permisos</a></li>
      <li><a href="../configuracion/fases.html">Fases del Proceso</a></li>
      <li><a href="../configuracion/roles.html">Roles y Permisos</a></li>
      <li><a href="../configuracion/usuarios.html">Usuarios</a></li>

      <div class="section-title"><b>Gestión ▿</b></div>
      <li><a href="../gestion/proveedores.html">Proveedores</a></li>
    </ul>
  </div>

  <!-- CONTENIDO -->
  <div class="content">
    <h2>✏️ Editar Proceso</h2>

    <form id="form-editar-proceso" class="info-card">
      <!-- Datos principales -->
      <div class="section-title">Información general</div>
      <div class="form-grid">
        <div class="form-group">
          <label>Título</label>
          <input type="text" name="titulo" value="Va Justiniano Carcamo Tronconis">
        </div>
        <div class="form-group">
          <label>ISBN</label>
          <input type="text" name="isbn" value="9786287768024">
        </div>
        <div class="form-group">
          <label>Cantidad</label>
          <input type="number" name="cantidad" value="22">
        </div>
        <div class="form-group">
          <label>Total línea</label>
          <input type="text" name="total" value="5000.00">
        </div>
        <div class="form-group">
          <label>Fase actual</label>
          <select name="fase">
            <option>Recepción</option>
            <option>Empaste</option>
            <option>Digitalización</option>
            <option>Control de Calidad</option>
          </select>
        </div>
        <div class="form-group">
          <label>Estado</label>
          <select name="estado">
            <option>Pendiente</option>
            <option>En Proceso</option>
            <option>Finalizado</option>
          </select>
        </div>
      </div>

      <!-- Fases seleccionables -->
      <div class="section-title">Fases del proceso</div>
      <div class="checkbox-group">
        <label><input type="checkbox" name="fases" value="catalogacion"> Catalogación</label>
        <label><input type="checkbox" name="fases" value="terminado"> Terminado Final</label>
        <label><input type="checkbox" name="fases" value="empaste"> Empaste</label>
        <label><input type="checkbox" name="fases" value="alistamiento"> Alistamiento</label>
        <label><input type="checkbox" name="fases" value="cambios"> Cambios de Estado</label>
        <label><input type="checkbox" name="fases" value="entrega"> Entrega Final</label>
        <label><input type="checkbox" name="fases" value="digitalizacion"> Digitalización</label>
        <label><input type="checkbox" name="fases" value="calidad"> Control de Calidad</label>
      </div>

      <!-- Acciones -->
      <div class="actions">
        <button type="submit" class="btn primary">Guardar cambios</button>
        <button type="button" class="btn secondary" onclick="window.location.href='detalle-procesos.html'">Cancelar</button>
      </div>
    </form>
  </div>

  <!-- Scripts -->
  <script src="../assets/js/flujo.js"></script>
  <script>
    document.getElementById('form-editar-proceso').addEventListener('submit', function(e) {
      e.preventDefault();

      const id = FLUJO.readId();
      const form = this;

      const datos = {
        titulo: form.titulo.value,
        isbn: form.isbn.value,
        cantidad: form.cantidad.value,
        total: form.total.value,
        fase: form.fase.value,
        estado: form.estado.value,
        fases: Array.from(form.querySelectorAll('input[name="fases"]:checked')).map(el => el.value)
      };

      // Guardar datos de la fase
      FLUJO.guardarFase(id, 'proceso', datos);

      // Redirigir a detalle de la fase seleccionada
      FLUJO.goDetalleSiguiente(id);
    });
  </script>
</body>
</html>
