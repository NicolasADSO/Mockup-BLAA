<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Editar Proceso - Control de Calidad</title>
  <link rel="stylesheet" href="../assets/css/layout.css">
  <link rel="stylesheet" href="../assets/css/editar.css">
</head>
<body>
  <!-- NAVBAR -->
  <div class="navbar">
    <img src="../assets/img/logo-sin-fondo.png" alt="Logo BlaaFlow">
    <div class="search-profile">
      <input type="text" placeholder="Buscar...">
      <div class="profile">A</div>
    </div>
  </div>

  <!-- SIDEBAR -->
  <div class="sidebar">
    <ul>
      <li><a href="../dashboard.html">Dashboard Admin</a></li>

      <div class="section-title"><b>Fases Especializadas ▿</b></div>
      <li><a href="../empaste/empaste.html">Encuadernación / Empaste</a></li>
      <li><a href="../catalogacion/catalogacion.html">Catalogaciones</a></li>
      <li><a href="../entrega/entrega.html">Entrega Final</a></li>
      <li><a href="../digitalizacion/digitalizacion.html">Digitalización</a></li>
      <li><a href="../calidad/calidad.html" class="active">Control de Calidad</a></li>
      <li><a href="../terminado/terminado.html">Terminado Final</a></li>
      <li><a href="../alistamiento/alistamiento.html">Alistamiento</a></li>

      <div class="section-title"><b>Seguimiento ▿</b></div>
      <li><a href="../control-procesos/procesos.html">Control de Procesos</a></li>

      <div class="section-title"><b>Configuración ▿</b></div>
      <li><a href="../configuracion/permisos.html">Permisos</a></li>
      <li><a href="../configuracion/fases.html">Fases del Proceso</a></li>
      <li><a href="../configuracion/roles.html">Roles y Permisos</a></li>
      <li><a href="../configuracion/usuarios.html">Usuarios</a></li>

      <div class="section-title"><b>Gestión ▿</b></div>
      <li><a href="../gestion/proveedores.html">Proveedores</a></li>
    </ul>
  </div>

  <!-- CONTENIDO -->
  <div class="content">
    <h2 class="page-title">✏️ Editar Proceso - Control de Calidad</h2>

    <div class="edit-card edit-form">
      <h3 class="section-title">Información de Control de Calidad</h3>

      <form id="form-calidad">
        <div class="field">
          <label>Revisor:</label>
          <input type="text" name="revisor" placeholder="Nombre del revisor">
        </div>

        <div class="field">
          <label>Fecha de Revisión:</label>
          <input type="date" name="fecha_revision">
        </div>

        <div class="field">
          <label>Resultado de Inspección:</label>
          <select name="resultado">
            <option value="aprobado">Aprobado</option>
            <option value="observacion">Con Observación</option>
            <option value="rechazado">Rechazado</option>
          </select>
        </div>

        <!-- Checklist -->
        <div class="field two-cols">
          <label>Checklist:</label>
          <div class="checklist">
            <label><input type="checkbox" name="paginas_completas"> Páginas completas</label><br>
            <label><input type="checkbox" name="encuadernacion_firme"> Encuadernación firme</label><br>
            <label><input type="checkbox" name="sin_manchas"> Sin manchas ni roturas</label><br>
            <label><input type="checkbox" name="metadatos_correctos"> Metadatos correctos</label>
          </div>
        </div>

        <div class="field two-cols">
          <label>Observaciones:</label>
          <textarea name="observaciones" placeholder="Notas del control de calidad"></textarea>
        </div>

        <div class="form-footer two-cols">
          <a href="../calidad/calidad.html" class="btn ghost">Volver al listado</a>
          <button type="submit" class="btn">Guardar Cambios</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Scripts -->
  <script src="../assets/js/flujo.js"></script>
  <script>
    document.getElementById('form-calidad').addEventListener('submit', function(e) {
      e.preventDefault();

      const id = FLUJO.readId();
      const datos = {
        revisor: this.revisor.value,
        fecha_revision: this.fecha_revision.value,
        resultado: this.resultado.value,
        checklist: {
          paginas_completas: this.paginas_completas.checked,
          encuadernacion_firme: this.encuadernacion_firme.checked,
          sin_manchas: this.sin_manchas.checked,
          metadatos_correctos: this.metadatos_correctos.checked,
        },
        observaciones: this.observaciones.value,
      };

      // Guardamos datos de la fase actual
      FLUJO.guardarFase(id, 'calidad', datos);

      // Avanzamos a la siguiente fase (terminado)
      FLUJO.goDetalleSiguiente(id);
    });
  </script>
</body>
</html>
